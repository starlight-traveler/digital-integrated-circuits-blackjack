# Digital Integrated Circuits Project - Blackjack Simulation
----

The Digital Integrated Circuits final project we designed was to create a
system capable of running a full game of blackjack with close to full
randomization and game play experience compared to a fully software defined system.

## Inputs and Outputs for the Blackjack Simulation Module

#### Inputs
1. **clk**: Clock signal for synchronous operation of the FSM and datapath.
2. **reset**: Asynchronous reset signal to reset the entire system to its initial state.
3. **card_in [4:0]**: 5-bit input representing the player's initial card values (range 1-13 for Blackjack card values).
4. **stand**: Signal indicating that the player chooses to stand.
5. **hit**: Signal indicating that the player chooses to draw another card.
6. **submit**: Action signal for dealing cards or confirming an operation.
7. **seed [4:0]**: 5-bit seed input for initializing the Linear Feedback Shift Register (LFSR) to generate pseudo-random card values.

#### Outputs
1. **dealer_sum [5:0]**: 6-bit output representing the total sum of the dealer's hand.
2. **player_sum [5:0]**: 6-bit output representing the total sum of the player's hand.
3. **win**: Signal indicating that the player has won the game.
4. **lose**: Signal indicating that the player has lost the game.
5. **draw**: Signal indicating that the game is a tie.
6. **blackjack**: Signal indicating that the player achieved a blackjack (a total of 21 from the initial two cards).

### Summary of I/O Bit Requirements
- **Input Bits**: 
  - 5 (card_in) + 1 (stand) + 1 (hit) + 1 (submit) + 5 (seed) = 13 bits.
- **Output Bits**: 
  - 6 (dealer_sum) + 6 (player_sum) + 1 (win) + 1 (lose) + 1 (draw) + 1 (blackjack) = 16 bits.

-----

## How the Blackjack Game Works

The Blackjack simulation is designed to simulate the real game Blackjack with automated acions from the rudimentary automated game play mechanic, random card generation, and a players decision process.

---

### **1. Initialization**
- The module begins in the `S_IDLE` state, waiting for the player to press the `submit` signal to start the game.
- When the game begins, the `reset` signal ensures all sums, counters, and flags are initialized:
  - `player_sum` and `dealer_sum` are set to 0.
  - Card counts for both the player and dealer are reset.
  - The Linear Feedback Shift Register (LFSR) is initialized with the provided `seed` or a default value for pseudo-random card generation.

---

### **2. Card Dealing**
- Transition to the `S_INIT_DEAL` state occurs after the player presses `submit`.
- The player and dealer each receive two cards:
  - The **player's cards** are input via `card_in` and added to `player_sum`.
  - The **dealer's cards** are generated using the LFSR and added to `dealer_sum`.
  - The card values range from 1 to 10:
    - Face cards (J, Q, K) are treated as 10.
    - Values greater than 13 are wrapped back into the 1-13 range.

#### Initial Blackjack Check:
- If either the player or the dealer has a sum of 21 after the initial two cards, the game transitions to the `S_EVAL` state to determine the winner or a draw.

---

### **3. Player's Turn**
- The game enters the `S_PLAYER_TURN` state, where the player decides to:
  - **Stand** (`stand` signal): End their turn and keep their current total.
  - **Hit** (`hit` signal): Draw a new card (generated by the LFSR) and add its value to their total (`player_sum`).
- The player can draw cards until they:
  - Reach a total of 21 or less and choose to stand.
  - Exceed 21 (`player_sum > 21`), which results in a "bust," and their turn ends automatically.

---

### **4. Dealer's Turn**
- Once the player's turn ends, the game transitions to the `S_DEALER_TURN` state.
- The dealer follows a fixed strategy:
  - Draw cards until their total (`dealer_sum`) is **17 or higher**.
  - Stop drawing cards if their total is 17 or greater or they "bust" (`dealer_sum > 21`).

---

### **5. Game Evaluation**
- The `S_EVAL` state compares the player's and dealer's totals:
  - **Player Wins**:
    - Dealer busts (`dealer_sum > 21`).
    - Player's total is greater than the dealer's total.
    - Player has an initial blackjack (21 with the first two cards).
  - **Dealer Wins**:
    - Player busts (`player_sum > 21`).
    - Dealer's total is greater than the player's total.
  - **Draw**:
    - Player and dealer have the same total.
    - Both have an initial blackjack.

#### Outputs:
- `win`, `lose`, and `draw` signals are asserted based on the evaluation.
- If the player achieves an initial blackjack, the `blackjack` signal is asserted.

---

### **6. Game Over**
- In the `S_DONE` state, the game waits for the `reset` signal to start a new game. All outputs remain stable until reset.

---

### **Random Card Generation**
- The LFSR generates pseudo-random card values based on the provided `seed`:
  - The LFSR shifts its state with feedback logic (`lfsr[4] ^ lfsr[2]`) on every `submit` pulse.
  - The resulting value is mapped to a valid Blackjack card value (1-10).

---

### **Gameplay Flow**
1. Player starts the game by pressing `submit`.
2. Initial cards are dealt to both the player and dealer.
3. Player decides to stand or hit until they either stand or bust.
4. Dealer automatically plays according to the rules.
5. The game evaluates the results, asserting `win`, `lose`, `draw`, or `blackjack` signals.
6. Game waits for a reset to begin again.

---

### Blackjack Rules Incorporated:
- **Card Values**: Cards are valued from 1-10 (face cards treated as 10).
- **Initial Blackjack**: A score of 21 with the first two cards is a win unless tied with the dealer.
- **Bust**: Scores over 21 automatically lose.
- **Dealer's Strategy**: Dealer must hit until their total is at least 17.